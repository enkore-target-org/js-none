import {
	getAPIMethodNames,
	generateAPIExportGlueCode
} from "@enkore/realm-js-factory"
import {defineConfig, defineAutogeneratedFile} from "enkore"
import {defineRealmConfig} from "@enkore/realm-js"

export default defineConfig({
	realm: {
		name: "js",
		config: defineRealmConfig({
			runtime: "node",
			exports: {
				"realmIntegrationAPI": {
					checkAgainstInterface: {
						named: ["@enkore/spec", "EnkoreTargetIntegrationAPI_V0_Rev0"]
					}
				}
			}
		})
	},

	autogeneratedFiles: [
		defineAutogeneratedFile(
			`project/export/realmIntegrationAPI/__aggregatedExports.mts`,
			() => {
				let code = ``

				code += `import {generateAPI} from "@enkore/realm-js-factory"\n`
				code += `import type {EnkoreTargetIntegrationAPI as API} from "@enkore/spec"\n`

				code += `const api = generateAPI({target: "js-none"});\n`

				code += generateAPIExportGlueCode(
					"API", "api", getAPIMethodNames()
				)

				return code
			}
		)
	]
})
