import {generateAPIExportGlueCode} from "@enkore/target-js-factory"
import {getTargetIntegrationAPIMethodNames} from "@enkore/target-js-factory/targetIntegration"
import {getProjectAPIMethodNames} from "@enkore/target-js-factory/project"
import {getAutogenerateAPIMethodNames} from "@enkore/target-js-factory/autogenerate"

import {
	createConfig,
	createTargetJSNoneOptions,
	createAutogeneratedFile
} from "enkore/spec/factory"

export const config: unknown = createConfig({
	target: {
		name: "js-none",
		options: createTargetJSNoneOptions({
			npm: {
				registry: [{
					url: "https://registry.npmjs.org/",
					authTokenFilePath: "./secrets/npm_auth_token"
				}, {
					url: "https://npm-registry.anio.software/",
					scope: ["@asint", "@asint-types"],
					clientPrivateKeyFilePath: "./secrets/npm_client.pkey",
					clientCertificateFilePath: "./secrets/npm_client.cert",
					authTokenFilePath: "./secrets/anio_npm_auth_token"
				}]
			},
			exports: {
				"targetIntegrationAPI": {
					checkAgainstInterface: [
						"@enkore/spec",
						"EnkoreTargetIntegrationAPI_V0_Rev0"
					]
				}
			}
		})
	},

	autogeneratedFiles: [
		createAutogeneratedFile({
			destinationPath: `project/export/targetIntegrationAPI/__aggregatedExports.mts`,
			generator() {
				let code = ``

				code += `import {generateTargetIntegrationAPI} from "@enkore/target-js-factory/targetIntegration"\n`
				code += `import type {EnkoreTargetIntegrationAPI_V0_Rev0 as API} from "@enkore/spec"\n`

				code += `const api = await generateTargetIntegrationAPI("js-none");\n`

				code += generateAPIExportGlueCode(
					"API", "api", getTargetIntegrationAPIMethodNames()
				)

				return code
			}
		}),

		createAutogeneratedFile({
			destinationPath: `project/export/project/__aggregatedExports.mts`,
			generator() {
				let code = ``

				code += `import {generateProjectAPI} from "@enkore/target-js-factory/project"\n`
				code += `import type {EnkoreTargetJSProjectAPI_V0_Rev0 as API} from "@enkore/spec"\n`

				code += `const api = await generateProjectAPI(["inferFromCLIArgs"]);\n`

				code += generateAPIExportGlueCode(
					"API", "api", getProjectAPIMethodNames()
				)

				return code
			}
		}),

		createAutogeneratedFile({
			destinationPath: `project/export/autogenerate/__aggregatedExports.mts`,
			generator() {
				let code = ``

				code += `import {generateAutogenerateAPI} from "@enkore/target-js-factory/autogenerate"\n`
				code += `import type {EnkoreTargetJSAutogenerateAPI_V0_Rev0 as API} from "@enkore/spec"\n`

				code += `const api = await generateAutogenerateAPI("js-none");\n`

				code += generateAPIExportGlueCode(
					"API", "api", getAutogenerateAPIMethodNames()
				)

				return code
			}
		})
	]
})
