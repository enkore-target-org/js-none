import {
	getAPIMethodNames,
	generateAPIExportGlueCode
} from "@enkore/target-js-factory"
import {defineConfig, defineAutogeneratedFile} from "enkore"
import {defineTargetConfig} from "@enkore-target/js-none"

export default defineConfig({
	target: defineTargetConfig({
		exports: {
			"realmIntegrationAPI": {
				checkAgainstInterface: [
					"@enkore/spec",
					"EnkoreTargetIntegrationAPI_V0_Rev0"
				]
			}
		}
	}),

	autogeneratedFiles: [
		defineAutogeneratedFile(
			`project/export/realmIntegrationAPI/__aggregatedExports.mts`,
			() => {
				let code = ``

				code += `import {generateAPI} from "@enkore/target-js-factory"\n`
				code += `import type {EnkoreTargetIntegrationAPI_V0_Rev0 as API} from "@enkore/spec"\n`

				code += `const api = generateAPI({target: "js-none"});\n`

				code += generateAPIExportGlueCode(
					"API", "api", getAPIMethodNames()
				)

				return code
			}
		)
	]
})
